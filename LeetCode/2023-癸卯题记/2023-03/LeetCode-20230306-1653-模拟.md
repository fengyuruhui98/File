# LeetCode-1653. 使字符串平衡的最少删除次数  
2023.03.06  
难度：中等    
给你一个字符串 s ，它仅包含字符 'a' 和 'b'​​​​ 。

你可以删除 s 中任意数目的字符，使得 s 平衡 。当不存在下标对 (i,j) 满足 i < j ，且 s[i] = 'b' 的同时 s[j]= 'a' ，此时认为 s 是 平衡 的。

请你返回使 s 平衡 的 最少 删除次数。


>示例 1：  
输入：s = "aababbab"  
输出：2  
解释：你可以选择以下任意一种方案：  
下标从 0 开始，删除第 2 和第 6 个字符（"aababbab" -> "aaabbb"），  
下标从 0 开始，删除第 3 和第 6 个字符（"aababbab" -> "aabbbb"）。  

>示例 2：  
输入：s = "bbaaaaabb"  
输出：2  
解释：唯一的最优解是删除最前面两个字符。  
 
提示：
1 <= s.length <= 105  
s[i] 要么是 'a' 要么是 'b'​ 。​

## 代码

超时

```c
#define MIN(a, b) (a > b ? b : a)

int minimumDeletions(char * s){
    int ** sum = (int **)malloc(sizeof(int **) * strlen(s)),ans = INT_MAX;
    for(int i = 0; i < strlen(s); ++i){
        sum[i] = (int *)malloc(sizeof(int) * 2);
        memset(sum[i], 0x00, sizeof(int) * 2);
    }
    for(int i = 1; i < strlen(s); ++i){
        if(s[i - 1] == 'b'){
            sum[i][0] = sum[i - 1][0] + 1;
        } else{
            sum[i][0] = sum[i - 1][0];
        } 
    }
    for(int i = strlen(s) - 2; i >= 0; --i){
        if(s[i + 1] == 'a'){
            sum[i][1] = sum[i + 1][1] + 1;
        }else {
            sum[i][1] = sum[i + 1][1];
        }
    }
    for(int i = 0; i < strlen(s); ++i){
        ans = MIN(ans, sum[i][0] + sum[i][1]);
    }
    return ans;
}
```
```c
#define MIN(a, b) ((a) < (b) ? (a) : (b))

int minimumDeletions(char * s) {
    int len = strlen(s);
    int leftb = 0, righta = 0;
    for (int i = 0; i < len; i++) {
        if (s[i] == 'a') {
            righta++;
        }
    }
    int res = righta;
    for (int i = 0; i < len; i++) {
        char c = s[i];
        if (c == 'a') {
            righta--;
        } else {
            leftb++;
        }
        res = MIN(res, leftb + righta);
    }
    return res;
}
```


## 答疑
问：为什么把 if-else 写成 (c - 'a') * 2 - 1 就会快很多？

答：CPU 在遇到分支（条件跳转指令）时会预测代码要执行哪个分支，如果预测正确，CPU 就会继续按照预测的路径执行程序。但如果预测失败，CPU 就需要回滚之前的指令并加载正确的指令，以确保程序执行的正确性。

对于本题的数据，字符‘a’ 和‘b’ 可以认为是随机出现的，在这种情况下分支预测就会有50% 的概率失败。失败导致的回滚和加载操作需要消耗额外的 CPU 周期，如果能用较小的代价去掉分支，对于本题的情况必然可以带来效率上的提升。

注意：这种优化方法往往会降低可读性，最好不要在业务代码中使用。

```c++
class Solution {
public:
    int minimumDeletions(string s) {
        int del = 0;
        for (char c : s)
            del += 'b' - c; // 统计 'a' 的个数
        int ans = del;
        for (char c : s) {
            // 'a' -> -1    'b' -> 1
            del += (c - 'a') * 2 - 1;
            ans = min(ans, del);
        }
        return ans;
    }
};
```