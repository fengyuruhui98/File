 SELECT  NVL((select Line_name_cn from tbl_ss_line_info where line_id = substr(batchtable.line_nid,1,2)) ,'未知线路') , batchtable.station_nid, NVL((select station_name_cn from tbl_ss_station_info where station_nid = batchtable.station_nid union all select station_name_cn from tbl_ss_special_station where station_nid = batchtable.station_nid),'未知车站') ,
                                            ticket_type, NVL((select TICKET_NAME from  (select TICKET_TYPE,TRIM(TICKET_NAME) TICKET_NAME from TBL_SS_TICKET_TYPE
                 union  
                 select 'FFFF','BOM故障退款' from dual
                 union  
                 select 'FFFE','TVM故障退款' from dual
                 union 
                 select 'FFFD','非营业性收入' from dual
                 union 
                 select 'FFFC','非营业性支出' from dual
                  ) where TICKET_TYPE=batchtable.TICKET_TYPE),'未知票卡类型') , ticket_category,'['||batchtable.operator_id||']'|| NVL((select user_name from tbl_ss_user where user_id = batchtable.operator_id), '未知操作员') ,
                                               SALE_COUNT, SALE_AMOUNT, 
                                               LOAD_COUNT, LOAD_AMOUNT, LOAD_OFFSET_COUNT, 
                                               LOAD_OFFSET_AMOUNT, UPDATE_COUNT, UPDATE_AMOUNT, 
                                               CARD_UPDATE_COUNT, CARD_UPDATE_AMOUNT, REFUND_COUNT, 
                                               REFUND_AMOUNT, DEPOSIT, TRANS_FEE, fault_count, fault_amount, 
                                               UNBUSINESS_IN_COUNT,UNBUSINESS_IN_AMOUNT,
                                               UNBUSINESS_OUT_COUNT,UNBUSINESS_OUT_AMOUNT,
                                               batchtable.trans_date,tbcd.su1/(SELECT count(*) FROM TBL_BATCH_TRANS_BOM_OPERATOR tt                                
WHERE trans_date between '20230616' and '20230616' and line_nid='05'  and station_nid='050A'  and payment_method = '01' AND tt.OPERATOR_ID = batchtable.operator_id)
                                        FROM TBL_BATCH_TRANS_BOM_OPERATOR batchtable  
                                        LEFT JOIN 
                                        (SELECT settle_date, trans_date, data_type, sum(data_amount) su1, operator_id, line_nid, station_nid 
                                        FROM TBL_BATCH_CASH_DIFF tbcd WHERE data_type = '1'AND device_type = '21'  GROUP BY settle_date, trans_date, operator_id, data_type, line_nid, station_nid) tbcd
                                        ON 
                                        batchtable.trans_date = tbcd.TRANS_DATE 
                                        AND batchtable.settle_date = tbcd.SETTLE_DATE 
                                        AND batchtable.operator_id = tbcd.OPERATOR_ID 
                                        AND batchtable.line_nid = tbcd.LINE_NID 
                                        AND batchtable.station_nid = tbcd.station_nid
                                        WHERE batchtable.trans_date between '20230616' and '20230616' and batchtable.line_nid='05'  and batchtable.station_nid='050A'  and batchtable.payment_method = '01' 
                                        
SELECT count(*) FROM TBL_BATCH_TRANS_BOM_OPERATOR tt                                
WHERE trans_date between '20230616' and '20230616' and line_nid='05'  and station_nid='050A'  and payment_method = '01' AND tt.OPERATOR_ID = batchtable.operator_id


```c#
StringBuilder sb = new StringBuilder();
            StringBuilder selectSQL1 = new StringBuilder().AppendFormat(@"  SELECT {0}, batchtable.station_nid,{1},
                                            ticket_type,{4}, ticket_category,'['||batchtable.operator_id||']'||{5},
                                               SALE_COUNT, SALE_AMOUNT, 
                                               LOAD_COUNT, LOAD_AMOUNT, LOAD_OFFSET_COUNT, 
                                               LOAD_OFFSET_AMOUNT, UPDATE_COUNT, UPDATE_AMOUNT, 
                                               CARD_UPDATE_COUNT, CARD_UPDATE_AMOUNT, REFUND_COUNT, 
                                               REFUND_AMOUNT, DEPOSIT, TRANS_FEE, fault_count, fault_amount, 
                                               UNBUSINESS_IN_COUNT,UNBUSINESS_IN_AMOUNT,
                                               UNBUSINESS_OUT_COUNT,UNBUSINESS_OUT_AMOUNT,
                                               batchtable.trans_date,tbcd.su1
                                        FROM TBL_BATCH_TRANS_BOM_OPERATOR batchtable  
                                        LEFT JOIN 
                                        (SELECT settle_date, trans_date, data_type, sum(data_amount) su1, operator_id, line_nid, station_nid 
                                        FROM TBL_BATCH_CASH_DIFF tbcd WHERE data_type = '1'AND device_type = '21'  GROUP BY settle_date, trans_date, operator_id, data_type, line_nid, station_nid) tbcd
                                        ON 
                                        batchtable.trans_date = tbcd.TRANS_DATE 
                                        AND batchtable.settle_date = tbcd.SETTLE_DATE 
                                        AND batchtable.operator_id = tbcd.OPERATOR_ID 
                                        AND batchtable.line_nid = tbcd.LINE_NID 
                                        AND batchtable.station_nid = tbcd.station_nid
                                        WHERE batchtable.trans_date between '{2}' and '{3}'",
                                                                        DataFactoryRP.LineQuery,
                                                                        DataFactoryRP.StationQuery,
                                                                        SettleDateBegin.ToString("yyyyMMdd"),
                                                                        SettleDateEnd.ToString("yyyyMMdd"),
                                                                        DataFactoryRP.TicketTypeQuery,
                                                                        DataFactoryRP.OperatorQuery
                                                                        );
            //string groupSQL = " GROUP BY line_nid,trans_date,station_nid,operator_id ";
            
            if (LineId != null && !"-1".Equals(LineId))
            {
                selectSQL1.AppendFormat(@" and batchtable.line_nid='{0}' ", LineId);
            }
            AFC_LoginUser _usr = AFC_LoginUser.CurrentUser;
            if (_usr.LineNid != "00")
            {
                selectSQL1.AppendFormat(@" and batchtable.line_nid = '{0}' ", _usr.LineNid);
            }
            if (StationId != null && !"-1".Equals(StationId))
            {
                selectSQL1.AppendFormat(@" and batchtable.station_nid='{0}' ", this.StationId);
            }
            selectSQL1.AppendFormat(@" and batchtable.payment_method = '01' ");
            sb.Append(selectSQL1);
```