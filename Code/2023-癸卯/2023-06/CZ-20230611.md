# 滁州长短款报表
```sql
--领用：3
--实际运营：2
--结算运营款：5

SELECT 
settle_date,
station_id, 
NVL((select station_name_cn from tbl_ss_station where  station_nid = batchtable.station_id ),'未知车站') ,
device_nid, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=batchtable.DEVICE_NID),'未知设备')  ,
out_operator,
sum(out_amount),
3 data_type
FROM T_CS_PETTYCASH_OUT batchtable
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='01'
GROUP BY settle_date,station_id, device_nid, out_operator
UNION ALL 
SELECT 
settle_date,
station_id,
NVL((select station_name_cn from tbl_ss_station where  station_nid = tcccb.station_id ),'未知车站') ,
device_nid, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=tcccb.DEVICE_NID),'未知设备')  ,
bom_operator,
sum(check_amount),
5 data_type 
FROM T_CS_CASH_CHECK_BOM tcccb
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='01'
GROUP BY settle_date,station_id, device_nid, bom_operator
UNION ALL 
SELECT 
settle_date,
station_nid,
NVL((select station_name_cn from tbl_ss_station where  station_nid = ttst.station_nid ),'未知车站') ,
device_nid, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=ttst.DEVICE_NID),'未知设备')  ,
operator_id,
sum(trans_value),
2 data_type 
FROM TBL_TR_SJT_TEMP ttst
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='01'
GROUP BY settle_date,station_nid, device_nid, operator_id
UNION ALL 
SELECT 
settle_date,
station_nid,
NVL((select station_name_cn from tbl_ss_station where  station_nid = ttst.station_nid ),'未知车站') ,
device_nid, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=ttst.DEVICE_NID),'未知设备')  ,
operator_id,
sum(trans_value),
2 data_type 
FROM TBL_TR_SVT_TEMP ttst
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='01'
GROUP BY settle_date,station_nid, device_nid, operator_id
UNION ALL 
SELECT 
settle_date,
station_nid,
NVL((select station_name_cn from tbl_ss_station where  station_nid = ttst.station_nid ),'未知车站') ,
device_nid, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=ttst.DEVICE_NID),'未知设备')  ,
operator_id,
sum(trans_value),
2 data_type 
FROM TBL_TR_QR_TEMP ttst
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='01'
GROUP BY settle_date,station_nid, device_nid, operator_id
UNION ALL 
SELECT 
settle_date,
station_nid,
NVL((select station_name_cn from tbl_ss_station where  station_nid = ttst.station_nid ),'未知车站') ,
device_nid, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=ttst.DEVICE_NID),'未知设备')  ,
operator_id,
sum(trans_value),
2 data_type 
FROM TBL_TR_PBOC_TEMP ttst
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='01'
GROUP BY settle_date,station_nid, device_nid, operator_id
```

```c#
if (RptType == 0 || RptType == 1)
{
    #region 数据查询
    StringBuilder sb = new StringBuilder();
    StringBuilder selectSQL1 = new StringBuilder().AppendFormat(@"  SELECT trans_date,station_nid,{2},
                                    device_nid,{3},
                                    operator_id,
                                sum(data_amount),
                                data_type
                                FROM TBL_BATCH_CASH_DIFF batchtable
                                WHERE trans_date >='{0}' and trans_date<='{1}' and device_type='21'",
                                                                this.SettleDateBegin.ToString("yyyyMMdd"),
                                                                this.SettleDateEnd.ToString("yyyyMMdd"),
                                                                DataFactoryRP.StationQuery,
                                                                DataFactoryRP.DeviceQuery);
    string groupSQL = " GROUP BY trans_date,station_nid,device_nid,operator_id,data_type";
    if (this.StationId != null && !"-1".Equals(StationId))
    {
        selectSQL1.AppendFormat(@" and station_nid='{0}' ", this.StationId);
    }
    sb.Append(selectSQL1).AppendFormat(groupSQL);
    var v = DB2DB.ST_RetrieveToObjects(sb.ToString(), _results, typeof (M_RP0117_CashDiff_Result));

    if (v.IsFailed)
    {
        MessageBox.Show(v.ErrorMessage, "错误", MessageBoxButton.OK, MessageBoxImage.Error);
        return;
    }

    #endregion

    foreach (var item in _results)
    {
        data.Add(item);
    }
}
if (RptType == 0 || RptType == 2)
{
    #region 数据查询

    StringBuilder sb = new StringBuilder();
    StringBuilder selectSQL1 = new StringBuilder().AppendFormat(@"  SELECT trans_date,station_nid,{2},
                                    device_nid,{3},
                                    operator_id,
                                sum(data_amount),
                                data_type
                                FROM TBL_BATCH_CASH_DIFF batchtable
                                WHERE trans_date >='{0}' and trans_date<='{1}' and device_type='11'",
                                                                this.SettleDateBegin.ToString("yyyyMMdd"),
                                                                this.SettleDateEnd.ToString("yyyyMMdd"),
                                                                DataFactoryRP.StationQuery,
                                                                DataFactoryRP.DeviceQuery);
    string groupSQL = " GROUP BY trans_date,station_nid,device_nid,operator_id,data_type";
    if (this.StationId != null && !"-1".Equals(StationId))
    {
        selectSQL1.AppendFormat(@" and station_nid='{0}' ", this.StationId);
    }
    sb.Append(selectSQL1).AppendFormat(groupSQL);
    var v = DB2DB.ST_RetrieveToObjects(sb.ToString(), _results2, typeof(M_RP0117_CashDiff_Result));

    if (v.IsFailed)
    {
        MessageBox.Show(v.ErrorMessage, "错误", MessageBoxButton.OK, MessageBoxImage.Error);
        return;
    }

    #endregion

    foreach (var item in _results2)
    {
        data2.Add(item);
    }
}
```


```sql
--领用：3
--实际运营：2
--结算运营款：5

--领用：3
--实际运营：2
--结算运营款：5
SELECT settle_date,station_id, station_name, device_id, device_name, operator, amount, data_type FROM (
SELECT 
settle_date,
station_id, 
NVL((select station_name_cn from tbl_ss_station where  station_nid = batchtable.station_id ),'未知车站')  station_name,
device_nid device_id, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=batchtable.DEVICE_NID),'未知设备') device_name ,
out_operator operator,
sum(out_amount) amount,
3 data_type
FROM T_CS_PETTYCASH_OUT batchtable
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='03'
GROUP BY settle_date,station_id, device_nid, out_operator
UNION ALL 
SELECT 
settle_date,
station_id,
NVL((select station_name_cn from tbl_ss_station where  station_nid = tcccb.station_id ),'未知车站') station_name,
device_nid device_id, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=tcccb.DEVICE_NID),'未知设备')  device_name,
bom_operator operator,
sum(check_amount) amount,
6 data_type 
FROM T_CS_CASH_CHECK_BOM tcccb
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='03'
GROUP BY settle_date,station_id, device_nid, bom_operator
UNION ALL 
SELECT 
settle_date,
station_nid station_id,
NVL((select station_name_cn from tbl_ss_station where  station_nid = ttst.station_nid ),'未知车站') station_name,
device_nid device_id, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=ttst.DEVICE_NID),'未知设备') device_name ,
operator_id operator,
sum(trans_value) amount,
2 data_type 
FROM TBL_TR_SJT_TEMP ttst
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='03'
GROUP BY settle_date,station_nid, device_nid, operator_id
UNION ALL 
SELECT 
settle_date,
station_nid station_id,
NVL((select station_name_cn from tbl_ss_station where  station_nid = ttst.station_nid ),'未知车站') station_name,
device_nid device_id, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=ttst.DEVICE_NID),'未知设备')  device_name,
operator_id operator,
sum(trans_value) amount,
2 data_type 
FROM TBL_TR_SVT_TEMP ttst
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='03'
GROUP BY settle_date,station_nid, device_nid, operator_id
UNION ALL 
SELECT 
settle_date,
station_nid station_id,
NVL((select station_name_cn from tbl_ss_station where  station_nid = ttst.station_nid ),'未知车站') station_name ,
device_nid device_id, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=ttst.DEVICE_NID),'未知设备')  device_name,
operator_id operator,
sum(trans_value) amount,
2 data_type 
FROM TBL_TR_QR_TEMP ttst
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='03'
GROUP BY settle_date,station_nid, device_nid, operator_id
UNION ALL 
SELECT 
settle_date,
station_nid station_id,
NVL((select station_name_cn from tbl_ss_station where  station_nid = ttst.station_nid ),'未知车站')station_name ,
device_nid device_id, 
NVL((select DEVICE_NID||'-'||DEVICE_NAME from TBL_SS_DEVICE_INFO where  DEVICE_NID=ttst.DEVICE_NID),'未知设备')  device_name,
operator_id operator,
sum(trans_value) amount,
2 data_type 
FROM TBL_TR_PBOC_TEMP ttst
WHERE settle_date >='20230406' and settle_date<='20230620' and substr(device_nid,0,2) ='03'
GROUP BY settle_date,station_nid, device_nid, operator_id
)
WHERE trim(station_id) = '0197'
```